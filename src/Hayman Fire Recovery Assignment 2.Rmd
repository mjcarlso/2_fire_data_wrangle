---
title: "Hayman Fire Recovery"
author: "MJ Carlson"
date: "2/3/2022"
output: html_document
---

```{r setup, warning=F,message=F}
library(tidyverse)
library(tidyr)
library(ggthemes)
library(lubridate)

# Now that we have learned how to munge (manipulate) data
# and plot it, we will work on using these skills in new ways

knitr::opts_knit$set(root.dir='..')
```


```{r dataread, warning=F,message=F}
####-----Reading in Data and Stacking it ----- ####
#Reading in files
files <- list.files('data',full.names=T)


#Read in individual data files
ndmi <- read_csv(files[1]) %>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndmi')


ndsi <- read_csv(files[2]) %>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndsi')

ndvi <- read_csv(files[3])%>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndvi')

# Stack as a tidy dataset
full_long <- rbind(ndvi,ndmi,ndsi) %>%
  gather(key='site',value='value',-DateTime,-data) %>%
  filter(!is.na(value))


```




## Question 1) 

What is the correlation between NDVI and NDMI? - here I want you to
convert the full_long dataset in to a wide dataset using the 
function "spread" and then make a plot that shows the correlation s a
function of if the site was burned or not (x axis should be ndmi)
You should exclude winter months and focus on summer months


```{r}
full_wide=full_long%>%
  spread(data, value)%>%
  filter_if(is.numeric,all_vars(!is.na(.)))

full_wide_xwinter<-full_wide%>%
  mutate(month=month(DateTime))%>%
  filter(month %in% c(5, 6, 7, 8, 9))
  

ggplot(full_wide_xwinter, aes(x=ndmi, y=ndvi, color=site))+
  geom_point()

```




## Question 2 

2) What is the correlation between average NDSI (normalized
 snow index) for January - April and average NDVI for June-August?
In other words, does the previous year's snow cover influence vegetation
 growth for the following summer?

```{r}
#ndsi winter data frame
ndsi_winter<-full_wide%>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(1,2,3,4))%>%
  subset(., select= -c(ndvi,ndmi))
#annual ndsi winter
ndsi_annual<-ndsi_winter%>%
  group_by(site, year)%>%
  summarize(mean_ndsi=mean(ndsi))

#ndvi summer data frame
ndvi_summer<-full_wide%>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(6,7,8))%>%
  subset(., select = -c(ndsi,ndmi))
#annual ndvi summer
ndvi_annual<-ndvi_summer%>%
  group_by(site, year)%>%
  summarize(mean_ndvi=mean(ndvi))

#combine data frames
combined<-inner_join(ndvi_annual,ndsi_annual)

#correlation
cor(combined$mean_ndsi, combined$mean_ndvi)

#correlation plot
ggplot(combined, aes(x=mean_ndsi, y=mean_ndvi, color=year, shape=site))+
  geom_point(size=2)

```

There is minimal correlation between the previous years snowfall and vegetation growth. The correlation coefficient is 0.18, meaning that the positive correlation is close to 0 or nearly no linear relationship.

## Q3

How is the snow effect from question 2 different between pre- and post-burn
and burned and unburned? 

```{r}
#pre and post burn
preburn<-c(1984:2001)
postburn<-c(2003:2019)

#preburn
#preburn annual ndsi
preburn_annualndsi<-full_wide[c(1,2,4)] %>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(1,2,3,4))%>% 
  filter(year %in% preburn)%>%
  group_by(site, year)%>%
  summarize(mean_preburnndsi=mean(ndsi))

#preburn annual ndvi
preburn_annualndvi<-full_wide[c(1,2,5)] %>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(6,7,8))%>% 
  filter(year %in% preburn)%>%
  group_by(site, year)%>%
  summarize(mean_preburnndvi=mean(ndvi))

#combine pre burn
combinepre<-inner_join(preburn_annualndsi,preburn_annualndvi)

#correlation pre burn
cor(combinepre$mean_preburnndsi, combinepre$mean_preburnndvi)


#postburn
#postburn annual ndsi
postburn_annualndsi<-full_wide[c(1,2,4)] %>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(1,2,3,4))%>% 
  filter(year %in% postburn)%>%
  group_by(site, year)%>%
  summarize(mean_postburnndsi=mean(ndsi))

#postburn annual ndvi
postburn_annualndvi<-full_wide[c(1,2,5)] %>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(6,7,8))%>% 
  filter(year %in% postburn)%>%
  group_by(site, year)%>%
  summarize(mean_postburnndvi=mean(ndvi))

#combine post burn
combinepost<-inner_join(postburn_annualndsi,postburn_annualndvi)

#correlation post burn
cor(combinepost$mean_postburnndsi, combinepost$mean_postburnndvi)


#burned and unburned correlation
#burned
#burned annual ndsi
burned_annualndsi<-full_wide[c(1,2,4)] %>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(1,2,3,4))%>% 
  filter(site %in% "burned")%>%
  group_by(site, year)%>%
  summarize(mean_burnndsi=mean(ndsi))

#burned annual ndvi
burned_annualndvi<-full_wide[c(1,2,5)] %>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(6,7,8))%>% 
  filter(site %in% "burned")%>%
  group_by(site, year)%>%
  summarize(mean_burnndvi=mean(ndvi))

#combine burned
combineburned<-inner_join(burned_annualndsi,burned_annualndvi)

#correlation unburned
cor(combineburned$mean_burnndsi, combineburned$mean_burnndvi)


#unburned
#unburned annual ndsi
unburned_annualndsi<-full_wide[c(1,2,4)] %>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(1,2,3,4))%>% 
  filter(site %in% "unburned")%>%
  group_by(site, year)%>%
  summarize(mean_unburnndsi=mean(ndsi))

#unburned annual ndvbi
unburned_annualndvi<-full_wide[c(1,2,5)] %>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(6,7,8))%>% 
  filter(site %in% "unburned")%>%
  group_by(site, year)%>%
  summarize(mean_unburnndvi=mean(ndvi))

#combine unburned
combineunburned<-inner_join(unburned_annualndsi,unburned_annualndvi)

#correlation unburned
cor(combineunburned$mean_unburnndsi, combineunburned$mean_unburnndvi)

```




## Question 4

What month is the greenest month on average? 

```{r}

```




## Question 5) 

What month is the snowiest on average?

```{r}

```




## Bonus Question: Redo all problems with `spread` and `gather` using modern tidyverse syntax. 


## Bonus Question: Use Climage Engine to pull the same data for the assignment, but updated with 2020/2021 data.




