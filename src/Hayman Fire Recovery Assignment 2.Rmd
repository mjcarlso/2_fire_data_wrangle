---
title: "Hayman Fire Recovery"
author: "MJ Carlson"
date: "2/3/2022"
output: html_document
---

```{r setup, warning=F,message=F}
library(tidyverse)
library(tidyr)
library(ggthemes)
library(lubridate)

# Now that we have learned how to munge (manipulate) data
# and plot it, we will work on using these skills in new ways

knitr::opts_knit$set(root.dir='..')
```


```{r dataread, warning=F,message=F}
####-----Reading in Data and Stacking it ----- ####
#Reading in files
files <- list.files('data',full.names=T)


#Read in individual data files
ndmi <- read_csv(files[1]) %>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndmi')


ndsi <- read_csv(files[2]) %>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndsi')

ndvi <- read_csv(files[3])%>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndvi')

# Stack as a tidy dataset
full_long <- rbind(ndvi,ndmi,ndsi) %>%
  gather(key='site',value='value',-DateTime,-data) %>%
  filter(!is.na(value))


```




## Question 1) 

What is the correlation between NDVI and NDMI? - here I want you to
convert the full_long dataset in to a wide dataset using the 
function "spread" and then make a plot that shows the correlation s a
function of if the site was burned or not (x axis should be ndmi)
You should exclude winter months and focus on summer months


pivot longer instead of gather for bonus question
```{r}
full_wide=full_long%>%
  spread(data, value)

full_wide_xwinter<-full_wide%>%
  mutate(month=month(DateTime))%>%
  filter(month %in% c(5, 6, 7, 8, 9))

ggplot(full_wide_xwinter, aes(x=ndmi, y=ndvi, color=site))+
  geom_point()

```


## Question 2 

2) What is the correlation between average NDSI (normalized
 snow index) for January - April and average NDVI for June-August?
In other words, does the previous year's snow cover influence vegetation
 growth for the following summer?

```{r}
#ndsi winter data frame
ndsi_winter<-full_wide%>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(1,2,3,4))%>%
  subset(., select= -c(ndvi,ndmi))
#annual ndsi winter
ndsi_annual<-ndsi_winter%>%
  group_by(site, year)%>%
  summarize(mean_ndsi=mean(ndsi))

#ndvi summer data frame
ndvi_summer<-full_wide%>%
  mutate(month=month(DateTime))%>%
  mutate(year=year(DateTime))%>%
  filter(month %in% c(6,7,8))%>%
  subset(., select = -c(ndsi,ndmi))
#annual ndvi summer
ndvi_annual<-ndvi_summer%>%
  group_by(site, year)%>%
  summarize(mean_ndvi=mean(ndvi))

#combine data frames
combined<-inner_join(ndvi_annual,ndsi_annual)

#correlation
cor

```



## Q3

How is the snow effect from question 2 different between pre- and post-burn
and burned and unburned? 

```{r}




```




## Question 4

What month is the greenest month on average? 

```{r}

```




## Question 5) 

What month is the snowiest on average?

```{r}

```




## Bonus Question: Redo all problems with `spread` and `gather` using modern tidyverse syntax. 


## Bonus Question: Use Climage Engine to pull the same data for the assignment, but updated with 2020/2021 data.




